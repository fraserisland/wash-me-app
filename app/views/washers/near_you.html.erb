<head>

	<%= javascript_include_tag 'ratyrate.js', "data-turbolinks-track" => false %>


<script type="text/javascript">
	$(document).ready(function(){
    $(".readonly-star .star").each(function() {
      $(this).raty('set', { readOnly: true });
    });
  });
</script>

</head>

<body style="margin: 33px">
<% if @washers.present? %>
  <table class="table">
		
    <thead>
      <tr>
        <th>Washer</th>
        <th>Cost(kg)</th>
        <th>Address</th>
        <th>Distance</th>
        <th>Rating</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @washers.each do |washer| %>
        <tr>

          <% if washer.user.avatar.present? %>
              <td><%= image_tag(washer.user.avatar.url(:thumb)) %><%= washer.user.first_name %> <%= washer.user.last_name %><br /></td>
            <% else %>
              <td><%= cl_image_tag("profile-blank.png", :width=>50, :height=>50, :crop=>"fill")%> <%= washer.user.first_name %> <%= washer.user.last_name %></td>
          <% end %>

          <td>$<%= washer.cost %></td>
          <td><%= washer.full_address %></td>
          <td><%= washer.distance.round(2) %> km</td>

          <% if current_user == washer.user %>
          <td class="readonly-star"> <%= rating_for washer, "experience", star_path: '/raty' %></td>
            <% else %>
              <td class="readonly-star"> <%= rating_for washer, "experience", star_path: '/raty' %></td>
          <% end %>

          <td><%= link_to 'Details', washer %></td>
					<% if current_user.can_update?(washer)%>
	          <td><%= link_to 'Edit', edit_washer_path(washer) %></td>
	          <td><%= link_to 'Destroy', washer, method: :delete, data: { confirm: 'Are you sure?' } %></td>
					<% end %>
				</tr>
        <% end %>
    </tbody>
  </table>
  <% else %>
      <p>No nearby washers! Sorry, try a differnent location.</p>
<% end %>
</body>
<style>
    /* Always set the map height explicitly to define the size of the div
     * element that contains the map. */
    #map {
      height: 100%;
    }
    /* Optional: Makes the sample page fill the window. */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>


  var contentString = '<div id=“content”>'+
   '<div id=“siteNotice”>'+
   '</div>'+
   '<h1 id=“firstHeading” class=“firstHeading”>Washer</h1>'+
   '<div id=“bodyContent”>'+
   '<p><b>washer</b>, also referred to as <b>Ayers Rock</b>, is a large ' +
   'sandstone rock formation in the southern part of the... '+

   'Heritage Site.taco </p>'+

   '<p>Attribution: Uluru, <a href=“https://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194“>'+
   'https://en.wikipedia.org/w/index.php?title=Uluru</a> '+
   '</div>'+
   '</div>';


    var map;
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 16,
        center: new google.maps.LatLng(<%= @location[0].latitude %>, <%= @location[0].longitude%>),
        mapTypeId: 'roadmap'
      });

      var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
           var icons = {
             info: {
               icon: '/washer.png'
             },
             you: {
               icon:'/dirty-washing.png'
             }
           };

      var features = [{
            position: new google.maps.LatLng(<%= @location[0].latitude %>, <%= @location[0].longitude %>),
            type: 'you' },
       <% @washers.each do |washer| %>
        {
          position: new google.maps.LatLng(<%= washer.latitude %>,<%= washer.longitude %>),
          type: 'info',
          url: '/washers/<%= washer.id %>'
        },
        <% end %>
      ];

      // Create markers.
      features.forEach(function(feature) {

        var infowindow = new google.maps.InfoWindow({
       content: contentString
         });

        var marker = new google.maps.Marker({
          position: feature.position,
          map: map,
          icon: icons[feature.type].icon,
					animation: google.maps.Animation.DROP
        });

        marker.addListener('click', function() {
          if (feature.url){
            window.location = feature.url
          }
        });
      });
    }
  </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDmo1j47I6KO4QRYJl_Z8PiSat_VhfWHnk&callback=initMap">
  </script>
